---
title: "Statistical Methods for Discrete Response, Time Series, and Panel Data (W271): Lab 2"
author: "Professor Jeffrey Yau"
output: 
  pdf_document:
  toc: true
  number_sections: true
fontsize: 11pt
geometry: margin=1in
---

# Instructions:

*  $\textbf{Due Date: Monday of Week 6 4p.m. Pacific Time}$
*  $\textbf{Page limit of the pdf report: 20 (not include title and the table of content page}$
  * Use the margin, linespace, and font size specification below:
    * fontsize=11pt
    * margin=1in
    * line_spacing=single

* Submission:
    * Each group makes one submission to Github; please have one of your team members made the submission
    * Submit 2 files:
        1. A pdf file including the details of your analysis and all the R codes used to produce the analysis. Please do not suppress the codes in your pdf file.
        2. R markdown file used to produce the pdf file
    * Use the following file-naming convensation; fail to do so will receive 10% reduction in the grade:
        * FirstNameLastName1_FirstNameLastName2_FirstNameLastName3_LabNumber.fileExtension
        * For example, if you have three students in the group for Lab Z, and their names are Gerard Kelley, Steve Yang, and Jeffrey Yau, then you should name your file the following
            * GerardKelley_SteveYang_JeffreyYau_LabZ.Rmd
            * GerardKelley_SteveYang_JeffreyYau_LabZ.pdf
    * Although it sounds obvious, please write the name of each members of your group on page 1 of your pdf and Rmd files.
    * This lab can be completed in a group of up to 3 students in your session. Students are encouraged to work in a group for the lab.

* Other general guidelines:
    * For statistical methods that we cover in this course, use only the R libraries and functions that are covered in this course. If you use libraries and functions for statistical modeling that we have not covered, you have to provide (1) explanation of why such libraries and functions are used instead and (2) reference to the library documentation. Lacking the explanation and reference to the documentation will result in a score of zero for the corresponding question.

    * In this particular lab, simply answer the following questions stated in Question 12 of chapter 3 (on page 189 and 190) of Bilder and Loughin's *"Analysis of Categorical Data with R"*
    
      *  **No need to include introduction, data examination, EDA, and conclusion sections.**

      * Since this question has **part a to h**, please write down each of the questions in your report so that we can easily follow your answers. 

* Students are expected to act with regards to UC Berkeley Academic Integrity.

\newpage
# Strategic Placement of Products in Grocery Stores

Answer **Question 12 of chapter 3 (on page 189 and 190)** of Bilder and Loughin's *"Analysis of Categorical Data with R"*.  Here is the background of this analysis, taken as an excerpt from this question:

In order to maximize sales, items within grocery stores are strategically placed to draw customer attention. This exercise examines one type of item—breakfast cereal. Typically, in large grocery stores, boxes of cereal are placed on sets of shelves located on one side of the aisle. By placing particular boxes of cereals on specific shelves, grocery stores may better attract customers to them. To investigate this further, a random sample of size 10 was taken from each of four shelves at a Dillons grocery store in Manhattan, KS. These data are given in the **cereal_dillons.csv** file. The response variable is the shelf number, which is numbered from bottom (1) to top (4), and the explanatory variables are the sugar, fat, and sodium content of the cereals.

```{r}
library(Hmisc)
cereal <- read.csv("cereal_dillons.csv")
head(cereal)
describe(cereal)
```

a. The explanatory variables need to be reformatted before proceeding further. 
    - First, divide each explanatory variable by its serving size to account for the different serving sizes among the cereals. 
  
    - Second, rescale each variable to be within 0 and 1.
```{r}
stand01 <- function(x) {(x - min(x)) /( max(x) - min(x))} 
cereal2 <- data.frame(Shelf = cereal$Shelf, sugar = 
                      stand01(x = cereal$sugar_g/cereal$size_g), 
                      fat = stand01(x = cereal$fat_g/cereal$size_g), 
                      sodium = stand01 (x = cereal$sodium_mg/cereal$size_g))

summary(cereal2)
```

   
  
b. Construct side-by-side box plots with dot plots overlaid for each of the explanatory variables. 
```{r}
boxplot(formula = sugar ~ Shelf, data = cereal2, ylab = "Sugar", xlab = "Shelf", pars = list(outpch = NA))
stripchart(x = cereal2$sugar ~ cereal2$Shelf, lwd = 2, col = "red", method = "jitter", vertical = TRUE, pch = 1, add = TRUE)
```

```{r}
boxplot(formula = fat ~ Shelf, data = cereal2, ylab = "Fat", xlab = "Shelf", pars = list(outpch = NA))
stripchart(x = cereal2$fat ~ cereal2$Shelf, lwd = 2, col = "blue", method = "jitter", vertical = TRUE, pch = 1, add = TRUE)
```

```{r}
boxplot(formula = sodium ~ Shelf, data = cereal2, ylab = "Sodium", xlab = "Shelf", pars = list(outpch = NA))
stripchart(x = cereal2$sodium ~ cereal2$Shelf, lwd = 2, col = "green", method = "jitter", vertical = TRUE, pch = 1, add = TRUE)
```

```{r}
library(MASS)
par(mar=c(2, 1, 2, 5),xpd = TRUE)
shelf.colors<-ifelse(test = cereal2$Shelf=="1", yes = "black", 
                    no = ifelse(test = cereal2$Shelf=="2", yes = "blue", no = ifelse(test = cereal2$Shelf=="3", yes = "green", no = "red")))
parcoord(x = cereal2[, c(2,3,4)], col = shelf.colors)                     
legend(3,0.5, legend = c("Shelf 4", "Shelf 3", "Shelf 2", "Shelf 1"), lty = "solid",
      col=c("red", "green", "blue", "black"), bty = 'n')                   
```

 Discuss if possible content differences exist among the shelves.

c. The response has values of $1, 2, 3,$ and $4$. Under what setting would it be desirable to take into account ordinality. Do you think that this setting occurs here?

*Not really - the ordering is more 1 = kids shelf, 2 and 3 prime shelves, 4 smaller brands*

d. Estimate a **multinomial regression model with linear forms of the sugar, fat, and sodium variables**. Perform **LRTs** to examine the importance of each explanatory variable.

```{r}
#Estimate model
mod.fit<-multinom(formula = Shelf ~ sugar_g + fat_g + sodium_mg, data=cereal)
summary(mod.fit)

# LRT for sugar_g:
mod.fit.Ho_sugar<-multinom(formula = Shelf ~ fat_g + sodium_mg, data=cereal)
anova(mod.fit.Ho_sugar, mod.fit)   

# LRT for fat_g:
mod.fit.Ho_fat<-multinom(formula = Shelf ~ sugar_g + sodium_mg, data=cereal)
anova(mod.fit.Ho_fat, mod.fit)   

# LRT for sodium_mg:
mod.fit.Ho_sodium<-multinom(formula = Shelf ~ sugar_g + fat_g, data=cereal)
anova(mod.fit.Ho_sodium, mod.fit)   
```

e. Show that there are no significant interactions among the explanatory variables (including an interaction among all three variables).

```{r}
# LRT for sugar*sodium interaction term:
mod.fit.Ho_sugar_sodium<-multinom(formula = Shelf ~ sugar_g + fat_g + sodium_mg + sugar_g:sodium_mg, data=cereal)
anova(mod.fit.Ho_sugar_sodium, mod.fit)   

# LRT for sugar*fat interaction term:
mod.fit.Ho_sugar_fat<-multinom(formula = Shelf ~ sugar_g + fat_g + sodium_mg + sugar_g:fat_g, data=cereal)
anova(mod.fit.Ho_sugar_fat, mod.fit)  

# LRT for fat*sodium interaction term:
mod.fit.Ho_fat_sodium<-multinom(formula = Shelf ~ sugar_g + fat_g + sodium_mg + sugar_g:sodium_mg, data=cereal)
anova(mod.fit.Ho_fat_sodium, mod.fit)  

# LRT for sugar*fat*sodium interaction term:
mod.fit.Ho_sugar_fat_sodium<-multinom(formula = Shelf ~ sugar_g + fat_g + sodium_mg + sugar_g:fat_g:sodium_mg, data=cereal)
anova(mod.fit.Ho_sugar_fat_sodium, mod.fit)  
```

f. Kellogg’s Apple Jacks (http://www.applejacks.com) is a cereal marketed toward children. For a serving size of $28$ grams, its sugar content is $12$ grams, fat content is $0.5$ grams, and sodium content is $130$ milligrams. Estimate the shelf probabilities for Apple Jacks.

```{r}
newdata <- data.frame(sugar_g = 12, fat_g = 0.5, sodium_mg = 130)

# pi^
pi.hat<-predict(object = mod.fit, newdata = newdata, type = "probs")
head(pi.hat)
```

g. Construct a plot similar to **Figure 3.3** where the estimated probability for a shelf is on the *y-axis* and the sugar content is on the *x-axis*. Use the mean overall fat and sodium content as the corresponding variable values in the model. Interpret the plot with respect to sugar content.
```{r}

```

h. Estimate odds ratios and calculate corresponding confidence intervals for each explanatory variable. Relate your interpretations back to the plots constructed for this exercise.
```{r}
# from wheat example, still figuring out exactly what it is doing/probably need to edit index numbers, esp choosing c

# Information about each variable to help with choosing c
sd.cereal<-apply(X = cereal[,-c(1,7,8)], MARGIN = 2, FUN = sd)
c.value<-c(1, sd.cereal)  # class = 1 is first value
round(c.value,2)

# beta.hat_jr for r = 1, ..., 3  and j = 2, 3, 4
beta.hat2<-coefficients(mod.fit)[1,2:4]
beta.hat3<-coefficients(mod.fit)[2,2:4]
beta.hat4<-coefficients(mod.fit)[3,2:4]
    
# Odds ratios for j = 2 vs. j = 1 
round(exp(c.value*beta.hat2),2)
round(1/exp(c.value*beta.hat2),2)
  
# Odds ratios for j = 3 vs. j = 2 
round(exp(c.value*beta.hat3),2)
round(1/exp(c.value*beta.hat3),2)

# Odds ratios for j = 4 vs. j = 3 
round(exp(c.value*beta.hat4),2)
round(1/exp(c.value*beta.hat4),2)
                       
# Wald CIs
conf.beta<-confint(object = mod.fit, level = 0.95)
round(conf.beta,2)  # Results are stored in a 3D array
conf.beta[2:4,1:2,1]  # C.I.s for beta_2r
conf.beta[2:4,1:2,2]  # C.I.s for beta_3r
conf.beta[2:4,1:2,3]  # C.I.s for beta_4r

# CIs for OR
ci.OR2<-exp(c.value*conf.beta[2:4,1:2,1])
ci.OR3<-exp(c.value*conf.beta[2:4,1:2,2])  
ci.OR4<-exp(c.value*conf.beta[2:4,1:2,3]) 

round(data.frame(low = ci.OR2[,1], up = ci.OR2[,2]), 2)
round(data.frame(low = ci.OR3[,1], up = ci.OR3[,2]), 2)
round(data.frame(low = ci.OR4[,1], up = ci.OR4[,2]), 2)
```








